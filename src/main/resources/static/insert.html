<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Admin</title>
    <style>
        body {
            padding: 20px;
        }

        .tab {
            display: inline-block;
            padding: 5px 15px;
            border: 1px solid black;
            background: white;
            cursor: pointer;
            margin-right: 5px;
        }

        .tab.active {
            background: black;
            color: white;
        }

        .tab-content {
            display: none;
            margin-top: 20px;
        }

        .tab-content.active {
            display: block;
        }

        .form-section {
            border: 1px solid black;
            padding: 10px;
            margin-bottom: 20px;
        }

        label {
            display: inline-block;
            margin-right: 10px;
        }

        input {
            margin-right: 10px;
        }

        button {
            padding: 5px 15px;
            margin-right: 5px;
        }

        table {
            border-collapse: collapse;
            margin-bottom: 20px;
        }

        td {
            border: 1px solid black;
            padding: 5px;
            text-align: center;
            min-width: 90px;
            cursor: pointer;
        }

        td:hover {
            background: #f0f0f0;
        }

        .date-cell {
            font-weight: bold;
        }

        .red-cell {
            color: red;
        }

        .message {
            display: none;
            margin: 10px 0;
            padding: 5px;
            border: 1px solid black;
        }

        .message.show {
            display: block;
        }

        .modal {
            display: none;
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: white;
            border: 2px solid black;
            padding: 20px;
            z-index: 1000;
        }

        .modal.show {
            display: block;
        }

        .overlay {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.5);
            z-index: 999;
        }

        .overlay.show {
            display: block;
        }

        .btn-delete {
            background: red;
            color: white;
        }
    </style>
</head>
<body>
<h1>Admin</h1>
<p>99.06.08</p>

<div>
    <div class="tab active" onclick="switchTab('smoking')">Smoking</div>
    <div class="tab" onclick="switchTab('sleep')">Sleep</div>
    <div class="tab" onclick="switchTab('sex')">Sex</div>
    <div class="tab" onclick="switchTab('exercise')">Exercise</div>
    <div class="tab" onclick="switchTab('diet')">Diet</div>
    <div class="tab" onclick="switchTab('caffeine')">Caffeine</div>
    <div class="tab" onclick="switchTab('alcohol')">Alcohol</div>
</div>

<div id="smoking" class="tab-content active">
    <div class="form-section">
        <div id="smokingMessage" class="message"></div>
        <label>Date <input type="date" id="smokingDate"></label>
        <label><input type="checkbox" id="smokingSmoke"> Smoked</label>
        <button onclick="saveSmoking()">Save</button>
    </div>
    <div id="smokingTable"></div>
</div>

<div id="sleep" class="tab-content">
    <div class="form-section">
        <div id="sleepMessage" class="message"></div>
        <label>Date <input type="date" id="sleepDate"></label>
        <label>Sleep <input type="time" id="sleepTime"></label>
        <label>Wake <input type="time" id="wakeTime"></label>
        <label><input type="checkbox" id="sleepViewPhone"> View Phone</label>
        <button onclick="saveSleep()">Save</button>
    </div>
    <div id="sleepTable"></div>
</div>

<div id="sex" class="tab-content">
    <div class="form-section">
        <div id="sexMessage" class="message"></div>
        <label>Date <input type="date" id="sexDate"></label>
        <label><input type="checkbox" id="sexSex"> Did it</label>
        <button onclick="saveSex()">Save</button>
    </div>
    <div id="sexTable"></div>
</div>

<div id="exercise" class="tab-content">
    <div class="form-section">
        <div id="exerciseMessage" class="message"></div>
        <label>Date <input type="date" id="exerciseDate"></label>
        <label><input type="checkbox" id="exerciseWork"> Worked out</label>
        <label>Time <input type="time" id="exerciseTime"></label>
        <button onclick="saveExercise()">Save</button>
    </div>
    <div id="exerciseTable"></div>
</div>

<div id="diet" class="tab-content">
    <div class="form-section">
        <div id="dietMessage" class="message"></div>
        <label>Date <input type="date" id="dietDate"></label>
        <label><input type="checkbox" id="dietDrink"> Consumed</label>
        <button onclick="saveDiet()">Save</button>
    </div>
    <div id="dietTable"></div>
</div>

<div id="caffeine" class="tab-content">
    <div class="form-section">
        <div id="caffeineMessage" class="message"></div>
        <label>Date <input type="date" id="caffeineDate"></label>
        <label><input type="checkbox" id="caffeineDrink"> Consumed</label>
        <button onclick="saveCaffeine()">Save</button>
    </div>
    <div id="caffeineTable"></div>
</div>

<div id="alcohol" class="tab-content">
    <div class="form-section">
        <div id="alcoholMessage" class="message"></div>
        <label>Date <input type="date" id="alcoholDate"></label>
        <label><input type="checkbox" id="alcoholDrink"> Consumed</label>
        <button onclick="saveAlcohol()">Save</button>
    </div>
    <div id="alcoholTable"></div>
</div>

<div class="overlay" id="overlay" onclick="closeModal()"></div>
<div class="modal" id="editModal">
    <h3>Edit / Delete</h3>
    <p id="modalDate"></p>
    <div id="modalContent"></div>
    <button onclick="updateRecord()">Update</button>
    <button class="btn-delete" onclick="deleteRecord()">Delete</button>
    <button onclick="closeModal()">Cancel</button>
</div>

<script>
    const API_BASE_URL = '';

    function formatTime(timeObj) {
        if (!timeObj) return '--:--';

        if (typeof timeObj === 'string') {
            return timeObj;
        }

        if (Array.isArray(timeObj)) {
            const hour = timeObj[0] || 0;
            const minute = timeObj[1] || 0;
            return `${String(hour).padStart(2, '0')}:${String(minute).padStart(2, '0')}`;
        }

        let hour = 0;
        let minute = 0;

        if (timeObj.hour !== undefined && timeObj.hour !== null) {
            hour = timeObj.hour;
        }
        if (timeObj.minute !== undefined && timeObj.minute !== null) {
            minute = timeObj.minute;
        }

        return `${String(hour).padStart(2, '0')}:${String(minute).padStart(2, '0')}`;
    }

    let currentEditType = '';
    let currentEditDate = '';
    let currentEditId = 0;

    function switchTab(tabName) {
        document.querySelectorAll('.tab-content').forEach(content => {
            content.classList.remove('active');
        });
        document.querySelectorAll('.tab').forEach(tab => {
            tab.classList.remove('active');
        });

        document.getElementById(tabName).classList.add('active');
        event.target.classList.add('active');
    }

    function showMessage(elementId, message) {
        const element = document.getElementById(elementId);
        element.textContent = message;
        element.classList.add('show');
        setTimeout(() => {
            element.classList.remove('show');
        }, 3000);
    }

    function openModal(type, date, data) {
        currentEditType = type;
        currentEditDate = date;
        currentEditId = data.id;
        document.getElementById('modalDate').textContent = date;
        const modalContent = document.getElementById('modalContent');

        if (type === 'smoking') {
            modalContent.innerHTML = `<label><input type="checkbox" id="editSmoke" ${data.smoke ? 'checked' : ''}> Smoked</label>`;
        } else if (type === 'sleep') {
            modalContent.innerHTML = `
                <label>Sleep <input type="time" id="editSleepTime" value="${data.sleepTime}"></label><br>
                <label>Wake <input type="time" id="editWakeTime" value="${data.wakeTime}"></label><br>
                <label><input type="checkbox" id="editViewPhone" ${data.viewPhone ? 'checked' : ''}> View Phone</label>
            `;
        } else if (type === 'sex') {
            modalContent.innerHTML = `<label><input type="checkbox" id="editSex" ${data.sex ? 'checked' : ''}> Did it</label>`;
        } else if (type === 'exercise') {
            modalContent.innerHTML = `
                <label><input type="checkbox" id="editWork" ${data.work ? 'checked' : ''}> Worked out</label><br>
                <label>Time <input type="time" id="editTime" value="${data.time}"></label>
            `;
        } else if (type === 'caffeine' || type === 'diet' || type === 'alcohol') {
            modalContent.innerHTML = `<label><input type="checkbox" id="editDrink" ${data.drink ? 'checked' : ''}> Consumed</label>`;
        }

        document.getElementById('overlay').classList.add('show');
        document.getElementById('editModal').classList.add('show');
    }

    function closeModal() {
        document.getElementById('overlay').classList.remove('show');
        document.getElementById('editModal').classList.remove('show');
    }

    async function updateRecord() {
        try {
            let url = `${API_BASE_URL}/${currentEditType}?date=${currentEditDate}`;

            if (currentEditType === 'smoking') {
                const smoke = document.getElementById('editSmoke').checked;
                url += `&smoke=${smoke}`;
            } else if (currentEditType === 'sleep') {
                const sleepTime = document.getElementById('editSleepTime').value;
                const wakeTime = document.getElementById('editWakeTime').value;
                const viewPhone = document.getElementById('editViewPhone').checked;
                url += `&sleepTime=${sleepTime}&wakeTime=${wakeTime}&viewPhone=${viewPhone}`;
            } else if (currentEditType === 'sex') {
                const sex = document.getElementById('editSex').checked;
                url += `&sex=${sex}`;
            } else if (currentEditType === 'exercise') {
                const work = document.getElementById('editWork').checked;
                const time = document.getElementById('editTime').value;
                url += `&work=${work}&time=${time}`;
            } else if (currentEditType === 'caffeine' || currentEditType === 'diet' || currentEditType === 'alcohol') {
                const drink = document.getElementById('editDrink').checked;
                url += `&drink=${drink}`;
            }

            const response = await fetch(url, { method: 'PUT' });

            if (response.ok) {
                showMessage(`${currentEditType}Message`, 'Updated');
                closeModal();
                loadData(currentEditType);
            } else {
                showMessage(`${currentEditType}Message`, 'Failed');
            }
        } catch (error) {
            showMessage(`${currentEditType}Message`, 'Error: ' + error.message);
        }
    }

    async function deleteRecord() {
        if (!confirm('Delete this record?')) return;

        try {
            const response = await fetch(`${API_BASE_URL}/${currentEditType}?id=${currentEditId}`, {
                method: 'DELETE'
            });

            if (response.ok) {
                showMessage(`${currentEditType}Message`, 'Deleted');
                closeModal();
                loadData(currentEditType);
            } else {
                showMessage(`${currentEditType}Message`, 'Failed');
            }
        } catch (error) {
            showMessage(`${currentEditType}Message`, 'Error: ' + error.message);
        }
    }

    async function saveSmoking() {
        const date = document.getElementById('smokingDate').value;
        const smoke = document.getElementById('smokingSmoke').checked;

        try {
            const response = await fetch(`${API_BASE_URL}/smoking?smoke=${smoke}&date=${date}`, {
                method: 'POST',
            });

            if (response.ok) {
                showMessage('smokingMessage', 'Saved');
                document.getElementById('smokingSmoke').checked = false;
                loadData('smoking');
            } else {
                showMessage('smokingMessage', 'Failed');
            }
        } catch (error) {
            showMessage('smokingMessage', 'Error: ' + error.message);
        }
    }

    async function saveSleep() {
        const date = document.getElementById('sleepDate').value;
        const sleepTime = document.getElementById('sleepTime').value;
        const wakeTime = document.getElementById('wakeTime').value;
        const viewPhone = document.getElementById('sleepViewPhone').checked;

        try {
            const response = await fetch(`${API_BASE_URL}/sleep?date=${date}&sleepTime=${sleepTime}&wakeTime=${wakeTime}&viewPhone=${viewPhone}`, {
                method: 'POST',
            });

            if (response.ok) {
                showMessage('sleepMessage', 'Saved');
                document.getElementById('sleepTime').value = '';
                document.getElementById('wakeTime').value = '';
                document.getElementById('sleepViewPhone').checked = false;
                loadData('sleep');
            } else {
                showMessage('sleepMessage', 'Failed');
            }
        } catch (error) {
            showMessage('sleepMessage', 'Error: ' + error.message);
        }
    }

    async function saveSex() {
        const date = document.getElementById('sexDate').value;
        const sex = document.getElementById('sexSex').checked;

        try {
            const response = await fetch(`${API_BASE_URL}/sex?sex=${sex}&date=${date}`, {
                method: 'POST',
            });

            if (response.ok) {
                showMessage('sexMessage', 'Saved');
                document.getElementById('sexSex').checked = false;
                loadData('sex');
            } else {
                showMessage('sexMessage', 'Failed');
            }
        } catch (error) {
            showMessage('sexMessage', 'Error: ' + error.message);
        }
    }

    async function saveExercise() {
        const date = document.getElementById('exerciseDate').value;
        const work = document.getElementById('exerciseWork').checked;
        const time = document.getElementById('exerciseTime').value;

        try {
            const response = await fetch(`${API_BASE_URL}/exercise?work=${work}&time=${time}&date=${date}`, {
                method: 'POST',
            });

            if (response.ok) {
                showMessage('exerciseMessage', 'Saved');
                document.getElementById('exerciseWork').checked = false;
                document.getElementById('exerciseTime').value = '';
                loadData('exercise');
            } else {
                showMessage('exerciseMessage', 'Failed');
            }
        } catch (error) {
            showMessage('exerciseMessage', 'Error: ' + error.message);
        }
    }

    async function saveDiet() {
        const date = document.getElementById('dietDate').value;
        const drink = document.getElementById('dietDrink').checked;

        try {
            const response = await fetch(`${API_BASE_URL}/diet?drink=${drink}&date=${date}`, {
                method: 'POST',
            });

            if (response.ok) {
                showMessage('dietMessage', 'Saved');
                document.getElementById('dietDrink').checked = false;
                loadData('diet');
            } else {
                showMessage('dietMessage', 'Failed');
            }
        } catch (error) {
            showMessage('dietMessage', 'Error: ' + error.message);
        }
    }

    async function saveCaffeine() {
        const date = document.getElementById('caffeineDate').value;
        const drink = document.getElementById('caffeineDrink').checked;

        try {
            const response = await fetch(`${API_BASE_URL}/caffeine?drink=${drink}&date=${date}`, {
                method: 'POST',
            });

            if (response.ok) {
                showMessage('caffeineMessage', 'Saved');
                document.getElementById('caffeineDrink').checked = false;
                loadData('caffeine');
            } else {
                showMessage('caffeineMessage', 'Failed');
            }
        } catch (error) {
            showMessage('caffeineMessage', 'Error: ' + error.message);
        }
    }

    async function saveAlcohol() {
        const date = document.getElementById('alcoholDate').value;
        const drink = document.getElementById('alcoholDrink').checked;

        try {
            const response = await fetch(`${API_BASE_URL}/alcohol?drink=${drink}&date=${date}`, {
                method: 'POST',
            });

            if (response.ok) {
                showMessage('alcoholMessage', 'Saved');
                document.getElementById('alcoholDrink').checked = false;
                loadData('alcohol');
            } else {
                showMessage('alcoholMessage', 'Failed');
            }
        } catch (error) {
            showMessage('alcoholMessage', 'Error: ' + error.message);
        }
    }

    async function loadData(type) {
        try {
            const response = await fetch(`${API_BASE_URL}/${type}/all`);
            const data = await response.json();

            if (data.length === 0) {
                document.getElementById(`${type}Table`).innerHTML = '<p>No data</p>';
                return;
            }

            data.sort((a, b) => new Date(a.date) - new Date(b.date));

            let html = '<table>';
            const chunkSize = 15;

            for (let i = 0; i < data.length; i += chunkSize) {
                const chunk = data.slice(i, i + chunkSize);

                html += '<tr>';
                chunk.forEach(item => {
                    html += `<td class="date-cell" onclick='openEditModal("${type}", "${item.date}", ${JSON.stringify(item)})'>${item.date}</td>`;
                });
                html += '</tr>';

                if (type === 'sleep') {
                    html += '<tr>';
                    chunk.forEach(item => {
                        const sleepTime = formatTime(item.sleepTime);
                        html += `<td onclick='openEditModal("${type}", "${item.date}", ${JSON.stringify(item)})'>${sleepTime}</td>`;
                    });
                    html += '</tr>';

                    html += '<tr>';
                    chunk.forEach(item => {
                        const wakeTime = formatTime(item.wakeTime);
                        html += `<td onclick='openEditModal("${type}", "${item.date}", ${JSON.stringify(item)})'>${wakeTime}</td>`;
                    });
                    html += '</tr>';

                    html += '<tr>';
                    chunk.forEach(item => {
                        const value = item.viewPhone ? 'O' : 'X';
                        const cellClass = value === 'O' ? 'red-cell' : '';
                        html += `<td class="${cellClass}" onclick='openEditModal("${type}", "${item.date}", ${JSON.stringify(item)})' title="View Phone">${value}</td>`;
                    });
                    html += '</tr>';
                } else if (type === 'exercise') {
                    html += '<tr>';
                    chunk.forEach(item => {
                        const value = item.work ? 'O' : 'X';
                        const cellClass = value === 'O' ? 'red-cell' : '';
                        html += `<td class="${cellClass}" onclick='openEditModal("${type}", "${item.date}", ${JSON.stringify(item)})'>${value}</td>`;
                    });
                    html += '</tr>';

                    html += '<tr>';
                    chunk.forEach(item => {
                        const time = formatTime(item.time);
                        html += `<td onclick='openEditModal("${type}", "${item.date}", ${JSON.stringify(item)})'>${time}</td>`;
                    });
                    html += '</tr>';
                } else {
                    html += '<tr>';
                    chunk.forEach(item => {
                        let value;
                        if (type === 'smoking') {
                            value = item.smoke ? 'O' : 'X';
                        } else if (type === 'sex') {
                            value = item.sex ? 'O' : 'X';
                        } else {
                            value = item.drink ? 'O' : 'X';
                        }
                        const cellClass = value === 'O' ? 'red-cell' : '';
                        html += `<td class="${cellClass}" onclick='openEditModal("${type}", "${item.date}", ${JSON.stringify(item)})'>${value}</td>`;
                    });
                    html += '</tr>';
                }
            }

            html += '</table>';
            document.getElementById(`${type}Table`).innerHTML = html;
        } catch (error) {
            document.getElementById(`${type}Table`).innerHTML = `<p>Error: ${error.message}</p>`;
        }
    }

    function openEditModal(type, date, item) {
        let data = { id: item.id };
        if (type === 'smoking') {
            data.smoke = item.smoke;
        } else if (type === 'sleep') {
            data.sleepTime = formatTime(item.sleepTime);
            data.wakeTime = formatTime(item.wakeTime);
            data.viewPhone = item.viewPhone;
        } else if (type === 'sex') {
            data.sex = item.sex;
        } else if (type === 'exercise') {
            data.work = item.work;
            data.time = formatTime(item.time);
        } else {
            data.drink = item.drink;
        }
        openModal(type, date, data);
    }

    window.addEventListener('DOMContentLoaded', () => {
        const today = new Date().toISOString().split('T')[0];
        document.getElementById('smokingDate').value = today;
        document.getElementById('sleepDate').value = today;
        document.getElementById('sexDate').value = today;
        document.getElementById('exerciseDate').value = today;
        document.getElementById('dietDate').value = today;
        document.getElementById('caffeineDate').value = today;
        document.getElementById('alcoholDate').value = today;

        loadData('smoking');
        loadData('sleep');
        loadData('sex');
        loadData('exercise');
        loadData('diet');
        loadData('caffeine');
        loadData('alcohol');
    });
</script>
</body>
</html>